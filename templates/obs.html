<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OBS Widget</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: transparent; overflow: hidden; font-family: 'Segoe UI', sans-serif; }

        #widget-container {
            position: fixed; top: 20px; left: 20px; width: 750px;
            opacity: 0.5; transform: scale(0.95);
            transition: all 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        .active { opacity: 1 !important; transform: scale(1) !important; }

        .obs-card {
            position: relative; display: flex; align-items: center;
            background: #1e1e1e; border-radius: 20px; overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.15);
            height: 140px; transition: all 0.5s ease;
        }

        .success-mode .obs-card { border-color: #28a745; box-shadow: 0 0 50px rgba(40, 167, 69, 0.8); }
        .fail-mode .obs-card    { border-color: #dc3545; box-shadow: 0 0 50px rgba(220, 53, 69, 0.8); }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –§–û–ù */
        .obs-card::before {
            content: ""; position: absolute; 
            top: -10%; left: -10%; width: 120%; height: 120%;
            background-color: #333; background-image: var(--bg-url);
            background-size: cover; background-position: center;
            filter: blur(15px) brightness(0.4); z-index: 0;
            transition: background-image 0.5s ease;
        }

        .cover-img {
            position: relative; z-index: 1; width: 180px; height: 100%;
            background-color: #111; background-image: var(--bg-url);
            background-size: cover; background-position: center;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5); border-right: 1px solid rgba(255,255,255,0.1);
        }

        .info-block {
            position: relative; z-index: 1; flex: 1; padding: 0 25px; color: white;
            display: flex; flex-direction: column; justify-content: center;
        }
        .label-now { color: #ff66aa; text-transform: uppercase; font-size: 0.8rem; font-weight: 800; letter-spacing: 2px; margin-bottom: 5px; }
        .map-title { font-size: 1.6rem; font-weight: 700; line-height: 1.1; margin-bottom: 5px; text-shadow: 0 2px 5px rgba(0,0,0,0.8); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .requester { font-size: 1rem; color: #ddd; }

        .status-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
            backdrop-filter: blur(4px);
        }
        .success-mode .status-overlay { opacity: 1; background: rgba(40, 167, 69, 0.9); }
        .fail-mode .status-overlay    { opacity: 1; background: rgba(220, 53, 69, 0.9); }

        #debug-status { position: fixed; bottom: 5px; right: 5px; color: lime; font-size: 10px; background: rgba(0,0,0,0.7); padding: 2px 5px; }
    </style>
</head>
<body>

<div id="widget-container">
    <div class="obs-card" id="card-el">
        <div class="status-overlay"></div>
        <div class="cover-img"></div>
        <div class="info-block">
            <div class="label-now">üî¥ Now Playing Request</div>
            <div class="map-title" id="title">Waiting for data...</div>
            <div class="requester">Requested by: <b id="user" style="color: #44ddff">---</b></div>
        </div>
    </div>
</div>
<div id="debug-status">Connecting...</div>

<script>
    const socket = io();
    const container = document.getElementById('widget-container');
    const cardEl = document.getElementById('card-el');
    const titleEl = document.getElementById('title');
    const userEl = document.getElementById('user');
    const debugEl = document.getElementById('debug-status');
    let resetTimer;

    socket.on('connect', () => { debugEl.innerText = "Connected"; debugEl.style.color = "lime"; });
    socket.on('disconnect', () => { debugEl.innerText = "Disconnected"; debugEl.style.color = "red"; });

    socket.on('update_obs', function(data) {
        resetState();
        titleEl.innerText = data.map_name;
        userEl.innerText = data.user;
        if (data.bg_url) cardEl.style.setProperty('--bg-url', `url('${data.bg_url}')`);
        else cardEl.style.removeProperty('--bg-url');
        container.classList.add('active');
    });

    socket.on('signal_obs_done', function() { showStatus('success-mode'); });
    socket.on('signal_obs_rejected', function() { showStatus('fail-mode'); });

    function showStatus(modeClass) {
        resetState();
        container.classList.add(modeClass);
        clearTimeout(resetTimer);
        resetTimer = setTimeout(() => {
            resetState();
            container.classList.remove('active');
            setTimeout(() => {
                titleEl.innerText = "Waiting for request...";
                userEl.innerText = "---";
                cardEl.style.removeProperty('--bg-url');
            }, 500);
        }, 2000); 
    }

    function resetState() {
        container.classList.remove('success-mode');
        container.classList.remove('fail-mode');
        clearTimeout(resetTimer);
    }
</script>
</body>
</html>




